Password hashing migration (Argon2id via libsodium)
===================================================

If you are upgrading from plaintext passwords to Argon2id hashes (libsodium), follow these steps:

1. Install libsodium development package for your distro (provide header and lib). Example on Debian/Ubuntu:

   apt-get install -y libsodium-dev

2. Build `msadmin` (Makefile already links libsodium):

   make msadmin

3. Backup and run migration using the provided wrapper (creates a timestamped backup then runs migrate):

   ./scripts/migrate-run.sh /path/to/microsocks.db --only-plaintext

   The script accepts `--yes` or `-y` to skip the interactive confirmation, and you can pass a list of usernames to restrict the migration to specific accounts.

4. To detect accounts that need rehashing under stronger parameters, run:

   ./msadmin migrate /path/to/microsocks.db --rehash-needs

Notes on parameters:
- The code uses libsodium's crypto_pwhash with the MODERATE preset by default (crypto_pwhash_OPSLIMIT_MODERATE / crypto_pwhash_MEMLIMIT_MODERATE). These are a good balance for small-to-medium servers.
- For high-security or low-traffic deployments, consider using crypto_pwhash_OPSLIMIT_SENSITIVE / crypto_pwhash_MEMLIMIT_SENSITIVE after benchmarking on your hardware.
- You can benchmark hashing speed on your machine with:

  ./msadmin benchmark

Recommended workflow:
- Run the `--rehash-needs` report to list accounts whose stored hashes should be upgraded.
- Use the application login path, or a scripted rehash, to set new stronger hashes (note: rehash requires plaintext passwords). For bulk migration of plaintext-stored passwords the `--only-plaintext` mode will hash them in-place.
